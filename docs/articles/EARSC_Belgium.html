<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Monitor infectious diseases with surveillance &bull; surveillancetutorials</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Surveillance Tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/surveillancer/tutorials">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Monitor infectious diseases with surveillance</h1>
                        <h4 class="author">The hackathon team (and a cat)</h4>
            
            <h4 class="date">November 29, 2016</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h1>
<p>Imagine you are an epidemiologist in charge of Salmonella surveillance for a whole country. One of your tasks is to detect potential outbreak as early as possible, in order to start an investigation and remove, e.g., infected ham from the supermarkets in your country. The later you detect and investigate the outbreak, the more people will have gotten sick. How can you know about an outbreak before there are so many cases that everyone is aware of the outbreak?</p>
<iframe src="https://giphy.com/gifs/ToMjGpNuOksUiclTp4c/html5" width="480" height="270" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
<p>Maybe (hopefully) you have data on the reported number of new cases of Salmonella each week. In absence of any outbreak, this number might be more or less the same every year for a given week: a little bit more in the summer, a little bit less in the winter. For other diseases it might always be approximately the same all the time no matter the season. So if for the present week you suddenly get more cases than usual&hellip; maybe you should make a few phone calls? The question is, how 1) to define what <em>more than usual</em> is and 2) to have your computer figure out alarms for you, instead of having to visualize and crunch numbers by hand? This is what <code>surveillance</code> does for you.</p>
<iframe src="https://giphy.com/gifs/11zYoBAFvX7Xhu/html5" width="500" height="250" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
<p>This tutorial will show how to use data from the Belgian surveillance system of infectious diseases for detecting an outbreak. The data are from the years 2005 to 2012, but we shall use them as if we were still in 2011, in order to perform prospective surveillance as it happens in real life: is there an anomaly in the number of cases this week? In other words, should you get worried now about a possible outbreak based on the currently available data?</p>
<iframe src="https://giphy.com/gifs/ue5ZwFCaxy64M/html5" width="480" height="280" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
</div>
<div id="first-step-getting-the-data-into-r" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#first-step-getting-the-data-into-r" class="anchor"> </a></body></html>First step: getting the data into R</h1>
<p>For this, ask your favourite data manager to set up a data connection, or follow steps similar to the following, where we use data from a csv file that we download from <a href="https://epistat.wiv-isp.be/data/public_cases.csv">this page</a> and that we then save as <code>.RData</code>. In this case we download the data behind the excellent Belgium <a href="https://epistat.wiv-isp.be/">epistat website</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">belgium &lt;-<span class="st"> </span>readr::<span class="kw">read_csv</span>(<span class="st">"https://epistat.wiv-isp.be/data/public_cases.csv"</span>)</code></pre></div>
<p>How does this data look like? Let us have a look at the head of the <code>data.frame</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr::<span class="kw">kable</span>(<span class="kw">head</span>(belgium))</code></pre></div>
<table class="table"><thead><tr class="header"><th align="right">Age</th>
<th align="left">DateMonday</th>
<th align="left">Gender</th>
<th align="left">Subject</th>
<th align="right">NUTS2</th>
</tr></thead><tbody><tr class="odd"><td align="right">34</td>
<td align="left">2005-01-03</td>
<td align="left">F</td>
<td align="left">CAM_SP</td>
<td align="right">21</td>
</tr><tr class="even"><td align="right">0</td>
<td align="left">2005-01-03</td>
<td align="left">M</td>
<td align="left">CAM_SP</td>
<td align="right">25</td>
</tr><tr class="odd"><td align="right">0</td>
<td align="left">2005-01-03</td>
<td align="left">M</td>
<td align="left">V_RTV</td>
<td align="right">21</td>
</tr><tr class="even"><td align="right">1</td>
<td align="left">2005-01-03</td>
<td align="left">M</td>
<td align="left">V_RTV</td>
<td align="right">25</td>
</tr><tr class="odd"><td align="right">2</td>
<td align="left">2005-01-03</td>
<td align="left">F</td>
<td align="left">V_RTV</td>
<td align="right">21</td>
</tr><tr class="even"><td align="right">1</td>
<td align="left">2005-01-03</td>
<td align="left">F</td>
<td align="left">V_RSV</td>
<td align="right">25</td>
</tr><tr class="odd"><td align="right">This d</td>
<td align="left">ataset has on</td>
<td align="left">e row per</td>
<td align="left">notified</td>
<td align="right">case, with</td>
</tr></tbody></table><ul><li><p><code>Age</code> age of the patient (in years);</p></li>
<li><p><code>DateMonday</code> date of the Monday of the week of report: we are dealing with weekly data;</p></li>
<li><p><code>Gender</code> gender of the patient;</p></li>
<li><p><code>Subject</code> category of the disease, e.g. <code>SALM</code> for Salmonella;</p></li>
<li><p><code>NUTS2</code> administrative subdivision of Belgium where the case was reported.</p></li>
</ul><p>We will start by looking at time series of cases for the whole country, i.e.&nbsp;aggregated for all age group and genders. For this, let&rsquo;s write a small function. This will load, filter and aggregate the data, and then make a <code>sts</code> object out of it. Such an object can be thought of as a wrapper for a time series, which will then be used by <code>surveillance</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">belgium_sts &lt;-<span class="st"> </span>function(disease, data){
  
  <span class="co"># filter the chosen disease</span>
  disease_data &lt;-<span class="st"> </span>dplyr::<span class="kw">filter_</span>(data, <span class="kw">paste0</span>(<span class="st">"Subject == </span><span class="ch">\"</span><span class="st">"</span>,disease,<span class="st">"</span><span class="ch">\"</span><span class="st">"</span>))

  <span class="co"># aggregated cases by week to get the weekly number of cases</span>
  observed &lt;-<span class="st"> </span>dplyr::<span class="kw">group_by</span>(disease_data, DateMonday)
  observed &lt;-<span class="st"> </span>dplyr::<span class="kw">summarize</span>(observed, <span class="dt">n_cases =</span> <span class="kw">n</span>())

  <span class="co"># create the sts object</span>
  disease_sts &lt;-<span class="st"> </span>surveillance::<span class="kw">sts</span>(<span class="dt">observed =</span> observed$n_cases, <span class="co"># weekly number of cases</span>
                                    <span class="dt">start =</span> <span class="kw">c</span>(<span class="kw">min</span>(lubridate::<span class="kw">year</span>(observed$DateMonday)), <span class="dv">01</span>), <span class="co"># first week of the time series</span>
                                    <span class="dt">frequency =</span> <span class="dv">52</span>, <span class="co"># weekly data</span>
                                    <span class="dt">epochAsDate =</span> <span class="ot">TRUE</span>, <span class="co"># we do have dates, not only index</span>
                                    <span class="dt">epoch =</span> <span class="kw">as.numeric</span>(observed$DateMonday) <span class="co"># here are the dates</span>
                                    )

  disease_sts
}</code></pre></div>
<p>Okay, let&rsquo;s test this function and make a quick plot!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(surveillance)
salmonella &lt;-<span class="st"> </span><span class="kw">belgium_sts</span>(<span class="dt">disease =</span> <span class="st">"SALM"</span>, <span class="dt">data =</span> belgium)
<span class="kw">plot</span>(salmonella)</code></pre></div>
<p><img src="EARSC_Belgium_files/figure-html/plot%20salmonella-1.png" width="672" style="display: block; margin: auto;"></p>
<p>So you see the seasonality of Salmonella reported cases: there are more of them in the summer.</p>
<p>Wait, are you lost here trying to transform your data into a <code>sts</code> object?</p>
<iframe src="https://giphy.com/gifs/3o85xqZZ20Sk51USTC/html5" width="480" height="300" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
<p>Let&rsquo;s have a look at this code again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">disease_sts &lt;-<span class="st"> </span>surveillance::<span class="kw">sts</span>(<span class="dt">observed =</span> observed$n_cases, <span class="co"># weekly number of cases</span>
                                    <span class="dt">start =</span> <span class="kw">c</span>(<span class="kw">min</span>(lubridate::<span class="kw">year</span>(observed$DateMonday)), <span class="dv">01</span>), <span class="co"># first week of the time series</span>
                                    <span class="dt">frequency =</span> <span class="dv">52</span>, <span class="co"># weekly data</span>
                                    <span class="dt">epochAsDate =</span> <span class="ot">TRUE</span>, <span class="co"># we do have dates, not only index</span>
                                    <span class="dt">epoch =</span> <span class="kw">as.numeric</span>(observed$DateMonday) <span class="co"># here are the dates</span>
                                    )</code></pre></div>
<p>This code helps going from a <code>data.frame</code> to <code>sts</code>, so basically a table. Let&rsquo;s say it&rsquo;s a table of chocolate (the weekly number of cases), eggs (the date of the Monday at the beginning of each week), and on the side butter (the frequency of the data, which is weekly) and sugar (the oldest week of the data). Using the code above, we prepare this information for the <code>surveillance</code> package. This package is a bit lazy so even if you feed it a vector of dates, you need to tell it what the frequency and minimum is. So from our <code>data.frame</code>/pile of ingredients we make a <code>sts</code>-object/cake, and then the analysis is&hellip; a piece of cake!</p>
<p>Okay, this was a bad pun, so let&rsquo;s monitor this time series and look for outbreaks.</p>
<iframe src="https://giphy.com/gifs/LHZyixOnHwDDy/html5" width="480" height="250" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
</div>
<div id="second-step-looking-for-outbreaks" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#second-step-looking-for-outbreaks" class="anchor"> </a></body></html>Second step: looking for outbreaks</h1>
<p>So, let&rsquo;s pretend we are still in 2011, so we&rsquo;ll use only the data up to 2011.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">salmonella2011 &lt;-<span class="st"> </span>salmonella[salmonella@epoch &lt;<span class="st"> </span>lubridate::<span class="kw">ymd</span>(<span class="st">"2012-01-01"</span>)]
<span class="kw">plot</span>(salmonella2011)</code></pre></div>
<p><img src="EARSC_Belgium_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>How do we know whether any of the past weeks had too high a number of cases? We&rsquo;ll start by using a pretty simple method from the CDC (okay, name dropping here), EARS (Early Aberration Detection System) C. This method will allow to use the weeks <code>now - baseline</code> up to <code>now - 1</code>, for which we&rsquo;ll compute the mean and standard deviation of the number of cases. We assume that the number of cases follows a non time-varying normal distribution during those weeks, and use the <code>(1 - alpha)</code>-th quantile of those distribution as a threshold. Let&rsquo;s say that if you wanted to use mean + 2 standard deviation as a threshold, this method actually nearly does that!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">no_of_weeks &lt;-<span class="st"> </span><span class="kw">length</span>(salmonella2011@observed)
monitored_salmonella2011 &lt;-<span class="st"> </span><span class="kw">earsC</span>(salmonella2011,
                                  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">range =</span> <span class="kw">c</span>((no_of_weeks -<span class="st"> </span><span class="dv">5</span>):<span class="st"> </span>no_of_weeks),
                                                 <span class="dt">method =</span> <span class="st">"C1"</span>,
                                                 <span class="dt">alpha =</span> <span class="fl">0.05</span>,
                                                 <span class="dt">baseline =</span> <span class="dv">10</span>))</code></pre></div>
<p>In the code above, we used a given variant of EARS C, denoted C1, and a value of 0.05 for <code>alpha</code>, and we used the 10 last weeks for calculating the mean and standard deviation of the number of weekly Salmonella cases. You can actually play with parameters and see how this changed the results by using <a href="https://t.co/qizcqqMbEJ">this Shiny app.</a>.</p>
<p>But we can already look at the results of the version of the algorithm we have just applied:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(monitored_salmonella2011)</code></pre></div>
<p><img src="EARSC_Belgium_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Yes, that&rsquo;s way too many cases for one those weeks: the number of observed cases is higher than the threshold and we get a small frightening red triangle (the outbreak symbol!)! We might have discovered an outbreak!</p>
<iframe src="https://giphy.com/gifs/8MmxXvaI795Kw/html5" width="480" height="160" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
<p>Note to the <code>tidyverse</code> addicts out there&hellip; You can transform <code>sts</code> objects into <code>data.frame</code> and then use all your usual tools!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">monitored_salmonella2011_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(monitored_salmonella2011)
knitr::<span class="kw">kable</span>(monitored_salmonella2011_df)</code></pre></div>
<table class="table"><thead><tr class="header"><th align="right">observed</th>
<th align="left">epoch</th>
<th align="left">state</th>
<th align="left">alarm</th>
<th align="right">upperbound</th>
<th align="right">population</th>
<th align="right">freq</th>
<th align="right">epochInPeriod</th>
</tr></thead><tbody><tr class="odd"><td align="right">49</td>
<td align="left">2011-11-21</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">81.00509</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">0.9038462</td>
</tr><tr class="even"><td align="right">125</td>
<td align="left">2011-11-28</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">75.35676</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">0.9230769</td>
</tr><tr class="odd"><td align="right">44</td>
<td align="left">2011-12-05</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">102.41307</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">0.9423077</td>
</tr><tr class="even"><td align="right">38</td>
<td align="left">2011-12-12</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">100.85656</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">0.9615385</td>
</tr><tr class="odd"><td align="right">38</td>
<td align="left">2011-12-19</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">101.20805</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">0.9807692</td>
</tr><tr class="even"><td align="right">46</td>
<td align="left">2011-12-26</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">100.00580</td>
<td align="right">1</td>
<td align="right">52</td>
<td align="right">1.0000000</td>
</tr></tbody></table><iframe src="https://giphy.com/gifs/3TpLIfyJLhpV6/html5" width="480" height="330" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#conclusion" class="anchor"> </a></body></html>Conclusion</h1>
<p>Now you&rsquo;re the cool person who knows how to monitor their surveillance data in order to automatically detect outbreaks.</p>
<iframe src="https://giphy.com/gifs/5gXYzsVBmjIsw/html5" width="480" height="350" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
<p>If you want to know more about the subject, e.g.&nbsp;more algorithms, more maths, please head to the Journal of Statistical Software and read <a href="https://www.jstatsoft.org/article/view/v070i10">our paper about <code>surveillance</code></a>. Aspects of your data you might want to better take into account might be seasonality, reporting delays, you name it: the chance is high that <code>surveillance</code> has something to offer. And tell your friends about <code>surveillance</code>!</p>
<iframe src="https://giphy.com/gifs/MjOlH8NgmXYdy/html5" width="480" height="270" frameborder="0" class="html5" allowfullscreen>
</iframe>
<p>
<a href="https://giphy.com/gifs/superman-eOewytQL4tOOA">via GIPHY</a>
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#introduction">Introduction</a></li>
      <li><a href="#first-step-getting-the-data-into-r">First step: getting the data into R</a></li>
      <li><a href="#second-step-looking-for-outbreaks">Second step: looking for outbreaks</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael H&ouml;hle, Sebastian Meyer, Ma&euml;lle Salmon, Dirk Schumacher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
