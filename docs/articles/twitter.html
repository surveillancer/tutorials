<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Monitor the Conference Twitter Feed &bull; surveillancetutorials</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Surveillance Tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/surveillancer/tutorials">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><script src="twitter_files/htmlwidgets-0.6/htmlwidgets.js"></script><script src="twitter_files/jquery-1.12.4/jquery.min.js"></script><script src="twitter_files/datatables-binding-0.2/datatables.js"></script><link href="twitter_files/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet"><link href="twitter_files/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet"><script src="twitter_files/dt-core-1.10.12/js/jquery.dataTables.min.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Monitor the Conference Twitter Feed</h1>
                        <h4 class="author">The Hackathon Team</h4>
            
            <h4 class="date">30 November 2016</h4>
          </div>

    
    
<div class="contents">
<p>This tutorial illustrates how one extracts data from twitter using <code>R</code> in order to quickly establish a tweet based monitoring system for critical event monitoring. We will use the <code>rtweet</code> package to harvest the data using the <a href="https://dev.twitter.com/overview/api">twitter API</a> and subsequently monitor them with the <code>surveillance</code> package.</p>
<div id="setting-up-the-twitter-api" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#setting-up-the-twitter-api" class="anchor"> </a></body></html>Setting up the twitter API</h2>
<p>The <a href="https://github.com/mkearney/rtweet">README.md</a> of the <code>rtweet</code> package provides helpful information on how to create a twitter app to automatically search tweets using the twitter AP</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rtweet)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(dplyr)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># A file containing the information of your twitter app. To protect the</span>
<span class="co"># information stored here, this is kept outside the public git repository.</span>
<span class="co">#</span>
<span class="co"># The contents of the file are simply:</span>
<span class="co"># twitter_token &lt;- create_token(app = "surveillance_trends", # whatever you named app</span>
<span class="co">#   consumer_key = "2zIXXX4L6USa4UfXXXXXXXXXX",</span>
<span class="co">#   consumer_secret = "oXXXXXXXSwwXXXXXXXXXXXXXXsXXXXXXXmXXXXXXXX")</span>

<span class="kw">source</span>(<span class="st">"~/Sandbox/Twitter-Trends/auth-trends.R"</span>,<span class="dt">encoding=</span><span class="st">"UTF8"</span>)</code></pre></div>
</div>
<div id="performing-queries" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#performing-queries" class="anchor"> </a></body></html>Performing Queries</h2>
<p>Perform the query, here we shall search for tweets containing the hashtag <code>#ESCAIDE2016</code>. The result is a list of individual tweets &ndash; this is almost similar to the well known concept of a linelist:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_query &lt;-<span class="st"> "#ESCAIDE2016 OR #ESCAIDE OR @ESCAIDE"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tweets &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(the_query, <span class="dt">n =</span> <span class="dv">15000</span>, <span class="dt">type=</span><span class="st">"recent"</span>, <span class="dt">token =</span> twitter_token)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT::<span class="kw">datatable</span>(<span class="kw">head</span>(tweets))</code></pre></div>
<div id="htmlwidget-1572" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1572">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["2016-12-02T20:34:18Z","2016-12-02T19:05:56Z","2016-12-02T18:40:01Z","2016-12-02T10:49:47Z","2016-12-02T07:40:04Z","2016-12-02T07:10:49Z"],[8.0478578598366e+17,8.04763547158737e+17,8.04757026442281e+17,8.04638688634348e+17,8.04590945115271e+17,8.04583582324969e+17],[6,0,0,22,8,8],[0,1,2,0,0,0],["RT @ECDC_TB: 1 out of 5 #tuberculosis patients has extrapulmonary TB, see ECDC full infographic here: https://t.co/nOpq6sJtXn #ESCAIDE2016","@StineNielsenEPI @Ammer_B @ESCAIDE @EANBoard absolutely essential topic, and a great exchange: public health is founded on #socialjustice","Dead but happy after an amazing #escaide2016. Thanks to @ESCAIDE! \nVery exciting things coming up with training programmes and #RECON.","RT @ECDC_Outbreaks: ECDC&amp;amp;EFSA report on foodborne diseases in the EU shows that Listeria cases have risen over recent years #ESCAIDE2016 ht","RT @VaccinesEurope: VE President @A_Rappagliosi at #ESCAIDE2016 on challenges to achieve optimal immunisation programmes #vaccines #vaccine","RT @VaccinesEurope: VE President @A_Rappagliosi at #ESCAIDE2016 on challenges to achieve optimal immunisation programmes #vaccines #vaccine"],[null,8.03543778153865e+17,null,null,null,null],[null,499153417,null,null,null,null],[null,"StineNielsenEPI",null,null,null,null],[false,false,false,false,true,true],[null,null,null,null,8.03885507012887e+17,8.03885507012887e+17],["Twitter for Android","Twitter Web Client","Twitter Web Client","Twitter for iPhone","Twitter for iPhone","Twitter for iPad"],["en","en","en","en","en","en"],[1495602342,34617210,1408449174,450621858,2160870648,165515893],["askraenzel","teachepi","TeebzR","CorradoConfa","juliettepayet","DutilleulAlain"],[1282878908,[499153417,114968487,2974549409,2800371230],2974549409,2754484003,[1262320285,2271928484],[1262320285,2271928484]],["ECDC_TB",["StineNielsenEPI","Ammer_B","ESCAIDE","EANBoard"],"ESCAIDE","ECDC_Outbreaks",["VaccinesEurope","A_Rappagliosi"],["VaccinesEurope","A_Rappagliosi"]],[["tuberculosis","ESCAIDE2016"],"socialjustice",["escaide2016","RECON"],"ESCAIDE2016",["ESCAIDE2016","vaccines"],["ESCAIDE2016","vaccines"]],["http://bit.ly/2gkhAOW",null,null,null,null,null],[true,false,false,true,true,true],["803969568251244545",null,null,"803548122458849280","803886760795185152","803886760795185152"],[null,null,null,null,null,null],[null,null,null,null,null,null],[null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> \u003c/th>\n      <th>created_at\u003c/th>\n      <th>status_id\u003c/th>\n      <th>retweet_count\u003c/th>\n      <th>favorite_count\u003c/th>\n      <th>text\u003c/th>\n      <th>in_reply_to_status_id\u003c/th>\n      <th>in_reply_to_user_id\u003c/th>\n      <th>in_reply_to_screen_name\u003c/th>\n      <th>is_quote_status\u003c/th>\n      <th>quoted_status_id\u003c/th>\n      <th>source\u003c/th>\n      <th>lang\u003c/th>\n      <th>user_id\u003c/th>\n      <th>screen_name\u003c/th>\n      <th>mentions_user_id\u003c/th>\n      <th>mentions_screen_name\u003c/th>\n      <th>hashtags\u003c/th>\n      <th>urls\u003c/th>\n      <th>is_retweet\u003c/th>\n      <th>retweet_status_id\u003c/th>\n      <th>place_name\u003c/th>\n      <th>country\u003c/th>\n      <th>coordinates\u003c/th>\n    \u003c/tr>\n  \u003c/thead>\n\u003c/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,6,7,10,13]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>A total of 1133 tweets were collected.</p>
<div id="descriptive-analysis" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#descriptive-analysis" class="anchor"> </a></body></html>Descriptive Analysis</h3>
<p>Who&rsquo;s tweeting? The tweets originate from a total of 256 users. The top 25 users (by their number of tweets) are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">top_tweeters &lt;-<span class="st"> </span>tweets %&gt;%<span class="st"> </span><span class="kw">group_by</span>(screen_name) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">nTweets=</span><span class="kw">n</span>()) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(nTweets)) %&gt;%
<span class="st">  </span><span class="kw">top_n</span>(<span class="dt">n=</span><span class="dv">25</span>)

<span class="kw">ggplot</span>( top_tweeters, <span class="kw">aes</span>(<span class="dt">x=</span>screen_name,<span class="dt">weight=</span>nTweets)) +<span class="st"> </span><span class="kw">geom_bar</span>() +<span class="st"> </span><span class="kw">coord_flip</span>() +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">"Number of tweets"</span>)</code></pre></div>
<p><img src="twitter_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Distribution of the different hashtags used in the tweets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">hashtag=</span><span class="kw">unlist</span>((tweets)$hashtags)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hashtag =</span> stringr::<span class="kw">str_trim</span>(hashtag), <span class="dt">hashtag =</span> <span class="kw">tolower</span>(hashtag)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!hashtag %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"escaide2016"</span>)) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(hashtag) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>()) %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(hashtag)) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(-n) %&gt;%<span class="st"> </span><span class="kw">top_n</span>(<span class="dt">n=</span><span class="dv">40</span>)

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>hashtag,<span class="dt">y=</span>n)) +<span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">"identity"</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</code></pre></div>
<p><img src="twitter_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Distribution of the system used for the tweeting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( tweets, <span class="kw">aes</span>(source)) +<span class="st"> </span><span class="kw">geom_bar</span>() +<span class="st"> </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="twitter_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Time series of the tweets (without interruptions):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)

## Make POSIX function for dplyr re-use
make_posix &lt;-<span class="st"> </span>. %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">time=</span>lubridate::<span class="kw">ymd_hms</span>(<span class="kw">paste0</span>(year,<span class="st">"-"</span>,month,<span class="st">"-"</span>,day,<span class="st">" "</span>,hour,<span class="st">":00:00"</span>),<span class="dt">tz=</span><span class="st">"CET"</span>))

##Are tweets a retweet of our tweet?
<span class="co">#the_tweet_id &lt;- tweets %&gt;% filter(screen_name == "m_hoehle") %&gt;% head(n=1) %&gt;% .[["status_id"]] %&gt;% as.character</span>
tweets &lt;-<span class="st"> </span>tweets %&gt;%<span class="st"> </span><span class="kw">mutate</span>( <span class="dt">is_retweet_of_us =</span> (!<span class="kw">is.na</span>(retweet_status_id ==<span class="st"> </span><span class="dv">803931871662972928</span>) &amp;<span class="st"> </span>retweet_status_id ==<span class="st"> </span><span class="dv">803931871662972928</span>))
<span class="co">#tweets2 &lt;- tweets %&gt;% mutate_( paste0("is_retweet_of_us = (retweet_status_id == ", the_tweet_id,")"))</span>

## All possible time points
ts &lt;-<span class="st"> </span>tweets %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">sprintf</span>(<span class="st">"%.02d"</span>,lubridate::<span class="kw">hour</span>(created_at)), <span class="dt">day=</span>lubridate::<span class="kw">day</span>(created_at),<span class="dt">month=</span>lubridate::<span class="kw">month</span>(created_at),<span class="dt">year=</span>lubridate::<span class="kw">year</span>(created_at)) %&gt;%
<span class="st">  </span>make_posix %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(time, is_retweet_of_us) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>(),<span class="dt">n_retweets=</span><span class="kw">sum</span>(is_retweet_of_us,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dt">n_noretweets=</span>n-n_retweets)

allTimes &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">year=</span><span class="dv">2016</span>, <span class="dt">month=</span><span class="dv">11</span>, <span class="dt">day=</span><span class="dv">25</span>:<span class="dv">30</span>, <span class="dt">hour=</span><span class="kw">sprintf</span>(<span class="st">"%.02d"</span>,<span class="dv">0</span>:<span class="dv">23</span>)) %&gt;%
<span class="st">  </span>make_posix %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(time) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="dv">0</span>)

ts2 &lt;-<span class="st"> </span>allTimes %&gt;%<span class="st"> </span><span class="kw">left_join</span>(ts, <span class="dt">by=</span><span class="st">"time"</span>) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(time) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(time &gt;<span class="st"> "2016-11-28 08:00:00 CET"</span> &amp;<span class="st"> </span>(time &lt;<span class="st"> "2016-11-30 17:30:00 CET"</span>)) %&gt;%<span class="st"> </span><span class="kw">select</span>(-n.x,-is_retweet_of_us,-n.y)

na2zero &lt;-<span class="st"> </span>function(x) {x[<span class="kw">is.na</span>(x)] &lt;-<span class="st"> </span><span class="dv">0</span> ; <span class="kw">return</span>(x)}

ts2 &lt;-<span class="st"> </span>ts2 %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">n_retweets =</span> <span class="kw">na2zero</span>(n_retweets),
                      <span class="dt">n_noretweets =</span> <span class="kw">na2zero</span>(n_noretweets)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">retweet =</span> n_retweets, <span class="dt">no_retweet =</span> n_noretweets)
ts3 &lt;-<span class="st"> </span>tidyr::<span class="kw">gather</span>(ts2, group, n, retweet:no_retweet)
ts3 &lt;-<span class="st"> </span>ts3 %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">group =</span> <span class="kw">factor</span>(group))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ts3) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>n, <span class="dt">fill=</span>group), <span class="dt">stat=</span><span class="st">"identity"</span>,<span class="dt">alpha=</span>.<span class="dv">8</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>)) +
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"No. of tweets"</span>) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Time"</span>) +<span class="st"> </span><span class="kw">ggtitle</span>(the_query) +
<span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_minor_breaks=</span><span class="st">"1 hour"</span>,<span class="dt">date_breaks=</span><span class="st">"1 hour"</span>,<span class="dt">date_labels=</span><span class="st">"Nov %d-%H:00"</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">size =</span> <span class="dv">6</span>), <span class="dt">legend.position =</span> <span class="st">"bottom"</span>) +
<span class="st">  </span>viridis::<span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">name=</span><span class="st">"Tweet Type"</span>, <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">"Standard tweet"</span>, 
                                                                            <span class="st">"Outbreak tweet/retweet"</span>))
p</code></pre></div>
<p><img src="twitter_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Now we overlay the conference program</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conference_program_slots &lt;-<span class="st"> </span>tibble::<span class="kw">tribble</span>(
  ~from, ~to, ~slot_type,
  <span class="st">"2016-11-28 09:00:00 CET"</span>,   <span class="st">"2016-11-28 10:30:00 CET"</span>, <span class="st">"Plenary Talks"</span>,
  <span class="st">"2016-11-28 11:00:00 CET"</span>,   <span class="st">"2016-11-28 12:40:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-28 14:30:00 CET"</span>,   <span class="st">"2016-11-28 15:30:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-28 15:30:00 CET"</span>,   <span class="st">"2016-11-28 16:30:00 CET"</span>, <span class="st">"Poster Session"</span>,
  <span class="st">"2016-11-28 17:00:00 CET"</span>,   <span class="st">"2016-11-28 18:30:00 CET"</span>, <span class="st">"Plenary Talks"</span>,

  <span class="st">"2016-11-29 09:00:00 CET"</span>,   <span class="st">"2016-11-29 10:30:00 CET"</span>, <span class="st">"Plenary Talks"</span>,
  <span class="st">"2016-11-29 11:00:00 CET"</span>,   <span class="st">"2016-11-29 12:40:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-29 14:30:00 CET"</span>,   <span class="st">"2016-11-29 15:30:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-29 15:30:00 CET"</span>,   <span class="st">"2016-11-29 16:30:00 CET"</span>, <span class="st">"Poster Session"</span>,
  <span class="st">"2016-11-28 17:00:00 CET"</span>,   <span class="st">"2016-11-28 18:30:00 CET"</span>, <span class="st">"Parallel Session"</span>,

  <span class="st">"2016-11-30 09:00:00 CET"</span>,   <span class="st">"2016-11-30 10:30:00 CET"</span>, <span class="st">"Plenary Talks"</span>,
  <span class="st">"2016-11-30 11:00:00 CET"</span>,   <span class="st">"2016-11-30 12:40:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-30 14:30:00 CET"</span>,   <span class="st">"2016-11-30 15:30:00 CET"</span>, <span class="st">"Parallel Session"</span>,
  <span class="st">"2016-11-30 15:30:00 CET"</span>,   <span class="st">"2016-11-30 16:30:00 CET"</span>, <span class="st">"Poster Session"</span>,
  <span class="st">"2016-11-30 17:00:00 CET"</span>,   <span class="st">"2016-11-30 18:30:00 CET"</span>, <span class="st">"Plenary Talks"</span>
) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">from =</span> <span class="kw">as.POSIXct</span>(from), <span class="dt">to =</span> <span class="kw">as.POSIXct</span>(to))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p +<span class="st"> </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw">filter</span>(conference_program_slots, to &lt;<span class="st"> "2016-11-30 17:30:00 CET"</span>),
            <span class="kw">aes</span>(<span class="dt">xmin =</span> from, <span class="dt">xmax =</span> to, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">max</span>(ts3$n), <span class="dt">color =</span> slot_type), <span class="dt">alpha =</span> <span class="fl">0.4</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) +
<span class="st">  </span>viridis::<span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">name =</span> <span class="st">"Session Type:"</span>)</code></pre></div>
<p><img src="twitter_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="outbreak-detection" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#outbreak-detection" class="anchor"> </a></body></html>Outbreak detection</h2>
<p>We shall use the EARS C method for performing outbreak detection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(surveillance)
baseline &lt;-<span class="st"> </span><span class="dv">7</span>
tweet_sts &lt;-<span class="st"> </span>surveillance::<span class="kw">sts</span>(<span class="dt">observed =</span> ts2$retweet +<span class="st"> </span>ts2$no_retweet, <span class="co"># weekly number of cases</span>
                               <span class="dt">epoch =</span> <span class="kw">as.numeric</span>(ts2$time))

monitored_tweets &lt;-<span class="st"> </span><span class="kw">earsC</span>(tweet_sts, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">baseline =</span> baseline))
monitored_tweets_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(monitored_tweets)

monitored_tweets_df &lt;-<span class="st"> </span><span class="kw">mutate</span>(monitored_tweets_df,
                          <span class="dt">time =</span> ts2$time[(baseline +<span class="st"> </span><span class="dv">1</span>):(<span class="kw">nrow</span>(ts2))])
<span class="kw">ggplot</span>(ts3) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(time, n, <span class="dt">fill =</span> group), <span class="dt">stat =</span> <span class="st">"identity"</span>) +
<span class="st">  </span>viridis::<span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">name =</span> <span class="st">"Alarm:"</span>) +
<span class="st">  </span><span class="kw">geom_step</span>(<span class="dt">data =</span> monitored_tweets_df, <span class="kw">aes</span>(time, upperbound)) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>)) +
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"No. of tweets"</span>) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Time"</span>) +<span class="st"> </span><span class="kw">ggtitle</span>(the_query) +
<span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_minor_breaks=</span><span class="st">"1 hour"</span>,<span class="dt">date_breaks=</span><span class="st">"1 hour"</span>,<span class="dt">date_labels=</span><span class="st">"Nov %d-%H:00"</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">size =</span> <span class="dv">6</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(monitored_tweets_df, alarm), <span class="kw">aes</span>(<span class="dt">x =</span> time), <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">"red"</span>) +
<span class="st">  </span>viridis::<span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">name=</span><span class="st">"Tweet Type"</span>, <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">"Standard tweet"</span>, 
                                                                            <span class="st">"Our outbreak tweet/retweet"</span>))</code></pre></div>
<p><img src="twitter_files/figure-html/ears-1.png" width="672" style="display: block; margin: auto;"></p>
<div id="instant-citizen-science-experiment" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#instant-citizen-science-experiment" class="anchor"> </a></body></html>Instant citizen science experiment</h3>
<p>Let&rsquo;s see, if we can artificially inject an outbreak into the time series. Retweet the post below, if you want to participate in an instant citizen science experiment.</p>
<center>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Syndromic surveillance at <a href="https://twitter.com/hashtag/escaide2016?src=hash">#escaide2016</a> ! Let's retweet &amp; create a virtual outbreak &#128567; <a href="https://t.co/zks5PZOTpM">https://t.co/zks5PZOTpM</a> <a href="https://twitter.com/ma_salmon"><span class="citation">@ma_salmon</span></a> <a href="https://twitter.com/dirk_sch"><span class="citation">@dirk_sch</span></a> <a href="https://twitter.com/hashtag/rstats?src=hash">#rstats</a> <a href="https://t.co/TLzm3oCvDM">pic.twitter.com/TLzm3oCvDM</a>
</p>
&mdash; Michael H&ouml;hle (@m_hoehle) <a href="https://twitter.com/m_hoehle/status/803931871662972928">November 30, 2016</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></center>
<p>For a not so serious version of the above citizen science experiment, see this <a href="http://staff.math.su.se/hoehle/blog/2016/09/25/sootb.html">blog post</a> on how to detect zombie outbreaks using twitter.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#setting-up-the-twitter-api">Setting up the twitter API</a></li>
      <li><a href="#performing-queries">Performing Queries</a></li>
      <li><a href="#outbreak-detection">Outbreak detection</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael H&ouml;hle, Sebastian Meyer, Ma&euml;lle Salmon, Dirk Schumacher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
